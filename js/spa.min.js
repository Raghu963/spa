!function(a,b){"use strict";var c=c||b,d=function(b){var c=new d.fn.init;return c.settings=$().extend({},c.settings,b),c.bp=c.settings.bp||backpack(),c.titleElement=document.querySelector(c.settings.titleSelector),c.settings.parseDOM&&c.setupRoutes(c.settings.viewSelector),a.addEventListener("hashchange",function(){c.swapView()}),c.getParameterByName(c.settings.forceReload)?(a.location.replace(a.location.href.split("?")[0]+"#!"+c.getParameterByName(c.settings.forceReload)),c):(c.settings.initView&&c.swapView(),c)};return d.fn=d.prototype={constructor:d,init:function(){return this},version:"0.0.5",bp:b,setupRoutes:function(){for(var a,b,c,d,e=this,f=e.settings,g=$(),h=g.extend(g.parseLocalStorage("routes")||{},f.routes),i=0,j=document.querySelectorAll(f.viewSelector);i<j.length;i++)b=j[i],b.hasAttributes()&&b.hasAttribute("id")&&(d=b.getAttribute("id"),a=b.hasAttribute("data-route")?b.getAttribute("data-route"):"",c=e.createRoute(d,a,b),h[c.path]=c);e.settings.routes=h,localStorage.setItem("routes",JSON.stringify(h)),e.bp&&""===e.getParameterByName("_escaped_fragment_")&&e.bp.updateViews(f.viewSelector)},createRoute:function(a,c,d){return{viewId:a,viewModule:d.hasAttribute("data-module")?d.getAttribute("data-viewId"):a,path:c.split("\\:")[0],params:c.split("\\:").slice(1),title:d.hasAttribute("data-title")?d.getAttribute("data-title"):this.settings.defaultTitle,transition:d.hasAttribute("data-transition")?d.getAttribute("data-transition"):"",paramValues:{},onload:d.hasAttribute("data-onload")?d.getAttribute("data-onload"):b,unload:d.hasAttribute("data-unload")?d.getAttribute("data-unload"):b}},matchRouteByPath:function(a,c){c||(c=this.settings.routes);var d,e,f,g,h,i={};if(c.hasOwnProperty(a))return c[a];for(d in c)if(c.hasOwnProperty(d)){if(e=c[d],h=new RegExp("\\b"+e.path+"\\b","gi"),""!==e.path&&0===a.search(h)){for(f=a.replace(e.path,"").split("/").slice(1),g=0;g<f.length;g++)i[e.params[g]]=f[g];e.paramValues=i;break}e=b}return e},matchRouteById:function(a,b){b||(b=this.settings.routes);var c;for(c in b)if(b[c].viewId===a)return b[c]},animation:b,getParameterByName:function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))},getVendorPropertyName:function(a){var b,c,d=["Moz","Webkit","O","ms"],e=a.charAt(0).toUpperCase()+a.substr(1);if(a in this.div.style)return a;for(c=0;c<d.length;++c)if(b=d[c]+e,b in this.div.style)return b},transitionend:{animation:"animationend",webkitAnimation:"webkitAnimationEnd",MozAnimation:"animationend",OAnimation:"oAnimationEnd"},cssPrefix:function(a){if(!a)return"";var b,c,d,e,f=document.body.style;if(a.indexOf("-")>=0){for(d=(""+a).split("-"),b=1,c=d.length;c>b;b++)d[b]=d[b].substr(0,1).toUpperCase()+d[b].substr(1);a=d.join("")}if(a in f)return a;for(a=a.substr(0,1).toUpperCase()+a.substr(1),e=["webkit","Moz","ms","O"],b=0,c=e.length;c>b;b++)if(e[b]+a in f)return e[b]+a;return""},removeExtraViews:function(a){for(var b=a.length;b>1;)b--,a[b].parentNode.removeChild(a[b])},pushGA:function(a){c!==b&&c.push(["_trackPageview",a])},swapView:function(){var c,d,e,f,g=this,h=g.settings,i=a.location.hash,j=g.getParameterByName("_escaped_fragment_"),k="#"!==i?i.replace("#!",""):"",l=k.split(":")[0],m=document.querySelectorAll("."+h.currentClass);m.length&&g.removeExtraViews(m),m=m[0],m&&m.id&&(d=g.matchRouteById(m.id)),c=g.matchRouteByPath(l),c!==b?(g.pushGA(l),g.ensureViewAvailable(m,c.viewId),f=document.getElementById(c.viewId),f&&(m?g.hasAnimations()&&(e=g.getAnimation(c),g.animation=e,e?(m.addEventListener(g.transitionend[g.cssPrefix("animation")],function(){g.endSwapAnimation.call(g,d,c),m=b}),$(m).addClass("animated out "+e).removeClass("in"),$(f).addClass(h.currentClass+" animated "+e+" in")):($(f).addClass(h.currentClass),g.endSwapAnimation.call(g,d,c))):h.intoAnimation?(f.addEventListener(g.transitionend[g.cssPrefix("animation")],function(){g.endSwapAnimation.call(g,d,c),m=b}),$(f).addClass(h.currentClass+" animated "+e+" in")):($(f).addClass(h.currentClass),g.endSwapAnimation.call(g,d,c)),g.setDocumentTitle(c),c&&g.makeCallback(c,"onload"))):""===j?a.location.hash="#!"+h.NotFoundRoute:f=$(h.viewSelector).addClass(h.currentClass)},getAnimation:function(a){return a?this.animations[a.transition]||this.settings.viewTransition:this.settings.viewTransition},endSwapAnimation:function(a,b){var c,d=this,e=document.querySelector(".current.out"),f=document.getElementById(b.viewId),g=d.animation;a&&d.makeCallback(a,"unload"),f.classList.contains("in")&&(f.classList.remove("in"),f.classList.remove(g)),e&&d.bp&&e.parentNode&&(c=e.parentNode,c.removeChild(e))},ensureViewAvailable:function(b,c){if(this.bp){var d,e,f=this.bp.getViewData(c);f?d=this.createFragment(f.content):(e=a.location.href.split("#!"),a.location.replace(e[0]+"?"+this.settings.forceReload+"="+e[1])),b?b.parentNode.insertBefore(d,b):document.querySelector(this.settings.mainWrappperSelector).appendChild(d)}},makeCallback:function(b,c){var d,e,f,g=this,h=g.settings;if(c&&!b[c]){var i=h.appContext;return void(h.appContext&&i[b.viewModule]&&i[b.viewModule][c]&&i[b.viewModule][c].call(i,b.paramValues||{}))}for(e=b[c].split("."),f=a[e[0]],d=1;d<e.length;d++)1===d&&(g=f),f=f[e[d]];f&&f.call(g,b.paramValues||{})},setDocumentTitle:function(a){var b,c=a.title;if(""!==c){for(b=0;b<a.params.length;b++)c=c.replace(":"+a.params[b],a.paramValues[a.params[b]]);document.title=c}},createFragment:function(a){var b=document.createDocumentFragment(),c=document.createElement("div");for(c.innerHTML=a;c.firstChild;)b.appendChild(c.firstChild);return b},hasAnimations:function(){var a=!1,c=document.createElement("div"),d="animation",e="",f="Webkit Moz O ms Khtml".split(" "),g="",h=0;if(c.style.animationName&&(a=!0),a===!1)for(h=0;h<f.length;h++)if(c.style[f[h]+"AnimationName"]!==b){g=f[h],d=g+"Animation",e="-"+g.toLowerCase()+"-",a=!0;break}return a},storeAsyncContent:function(a){this.bp.updateViewsFromFragment(this.settings.viewSelector,a)},animations:{slide:"slide",fade:"fade",flip:"flip"},settings:{routes:[],viewSelector:".content-pane",currentClass:"current",mainWrappperSelector:"main",NotFoundView:"nofoundView",NotFoundRoute:"404",defaultTitle:"A Single Page Application with Routes",titleSelector:".view-title",forceReload:"_force_reload_",autoSetTitle:!0,parseDOM:!0,initView:!0,intoAnimation:!0,viewTransition:"slide",asyncUrl:b}},d.fn.init.prototype=d.fn,a.spa=d}(window);