/*!
 * SPAjs v0.5.0 (https://github.com/docluv/spajs)
 * Copyright 2013-2014 Chris Love
 * Licensed under Apache (https://github.com/docluv/spajs/LICENSE)
 */
!function(a,b){"use strict";var c=c||b,d=function(b){var c=new d.fn.init,e="";if(c.settings=$.extend({},c.settings,b),c.settings.AppContext)c.$rootScope=c.settings.AppContext;else{var f=document.querySelector("[spa-app]");if(!f)throw console.error("Must have an application context defined"),{name:"SPA Error",message:"Must have an application context defined"};e=a[f.getAttribute("spa-app")],"function"==typeof e&&(e=e()),c.$rootScope=e}return c.bp=c.settings.bp||backpack(),c.titleElement=document.querySelector(c.settings.titleSelector),c.settings.parseDOM&&c.setupRoutes(c.settings.viewSelector),a.addEventListener("hashchange",function(){c.swapView()}),c.getParameterByName(c.settings.forceReload)?(a.location.replace(a.location.href.split("?")[0]+"#!"+c.getParameterByName(c.settings.forceReload)),c):(c.settings.initView&&c.swapView(),c)};return d.fn=d.prototype={constructor:d,init:function(){return this},version:"0.0.6",bp:b,$rootScope:b,$scope:b,$oldScope:b,setupRoutes:function(){for(var a,b,c,d,e=this,f=e.settings,g=$.extend($.parseLocalStorage("routes")||{},f.routes),h=0,i=document.querySelectorAll(f.viewSelector);h<i.length;h++)b=i[h],b.hasAttributes()&&b.hasAttribute("id")&&(d=b.getAttribute("id"),a=b.hasAttribute("spa-route")?b.getAttribute("spa-route"):"",c=e.createRoute(d,a,b),g[c.path]=c);e.settings.routes=g,localStorage.setItem("routes",JSON.stringify(g)),e.bp&&""===e.getParameterByName("_escaped_fragment_")&&e.bp.updateViews(f.viewSelector)},createRoute:function(a,c,d){return{viewId:a,viewModule:d.hasAttribute("spa-module")?d.getAttribute("spa-viewId"):a,path:c.split("\\:")[0],params:c.split("\\:").slice(1),title:d.hasAttribute("spa-title")?d.getAttribute("spa-title"):this.settings.defaultTitle,transition:d.hasAttribute("spa-transition")?d.getAttribute("spa-transition"):"",paramValues:{},beforeonload:d.hasAttribute("spa-beforeonload")?d.getAttribute("spa-beforeonload"):b,onload:d.hasAttribute("spa-onload")?d.getAttribute("spa-onload"):b,afteronload:d.hasAttribute("spa-afteronload")?d.getAttribute("spa-afteronload"):b,beforeunload:d.hasAttribute("spa-beforeunload")?d.getAttribute("spa-beforeunload"):b,unload:d.hasAttribute("spa-unload")?d.getAttribute("spa-unload"):b,afterunload:d.hasAttribute("spa-afterunload")?d.getAttribute("spa-afterunload"):b}},matchRouteByPath:function(a,c){c||(c=this.settings.routes);var d,e,f,g,h,i={};if(c.hasOwnProperty(a))return c[a];for(d in c)if(c.hasOwnProperty(d)){if(e=c[d],h=new RegExp("\\b"+e.path+"\\b","gi"),""!==e.path&&0===a.search(h)){for(f=a.replace(e.path,"").split("/").slice(1),g=0;g<f.length;g++)i[e.params[g]]=f[g];e.paramValues=i;break}e=b}return e},matchRouteById:function(a,b){b||(b=this.settings.routes);var c;for(c in b)if(b[c].viewId===a)return b[c]},animation:b,getParameterByName:function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))},getVendorPropertyName:function(a){var b,c,d=["Moz","Webkit","O","ms"],e=a.charAt(0).toUpperCase()+a.substr(1);if(a in this.div.style)return a;for(c=0;c<d.length;++c)if(b=d[c]+e,b in this.div.style)return b},transitionend:{animation:"animationend",webkitAnimation:"webkitAnimationEnd",MozAnimation:"animationend",OAnimation:"oAnimationEnd"},cssPrefix:function(a){if(!a)return"";var b,c,d,e,f=document.body.style;if(a.indexOf("-")>=0){for(d=(""+a).split("-"),b=1,c=d.length;c>b;b++)d[b]=d[b].substr(0,1).toUpperCase()+d[b].substr(1);a=d.join("")}if(a in f)return a;for(a=a.substr(0,1).toUpperCase()+a.substr(1),e=["webkit","Moz","ms","O"],b=0,c=e.length;c>b;b++)if(e[b]+a in f)return e[b]+a;return""},removeExtraViews:function(a){for(var b=a.length;b>1;)b--,a[b].parentNode.removeChild(a[b])},pushGA:function(a){c!==b&&c.push(["_trackPageview",a])},swapView:function(){var c,d,e,f,g=this,h=g.settings,i=a.location.hash,j=g.getParameterByName("_escaped_fragment_"),k="#"!==i?i.replace("#!",""):"",l=k.split(":")[0],m=document.querySelectorAll("."+h.currentClass);if(g.$oldScope=g.$scope,m.length&&m.length>1&&g.removeExtraViews(m),m=m[0],m&&m.id&&(d=g.matchRouteById(m.id)),c=g.matchRouteByPath(l),c!==b){if(g.$rootScope[c.viewId]&&"function"==typeof g.$rootScope[c.viewId])g.$scope=new g.$rootScope[c.viewId](g.$rootScope);else{if(!g.$rootScope[c.viewId]||"object"!=typeof g.$rootScope[c.viewId])return;g.$scope=new g.$rootScope[c.viewId]}g.pushGA(l),g.ensureViewAvailable(m,c.viewId),f=document.getElementById(c.viewId),f&&(m?(g.makeViewCallback1(g.$oldScope,"beforeunload"),g.hasAnimations()&&(e=g.getAnimation(c),g.animation=e,e?(m.addEventListener(g.transitionend[g.cssPrefix("animation")],function(){g.endSwapAnimation.call(g,d,c),m=b}),$(m).addClass("animated out "+e).removeClass("in"),$(f).addClass(h.currentClass+" animated "+e+" in")):($(f).addClass(h.currentClass),g.endSwapAnimation.call(g,d,c)))):h.intoAnimation?(f.addEventListener(g.transitionend[g.cssPrefix("animation")],function(){g.endSwapAnimation.call(g,d,c),m=b}),$(f).addClass(h.currentClass+" animated "+e+" in")):($(f).addClass(h.currentClass),g.endSwapAnimation.call(g,d,c)),g.setDocumentTitle(c),c&&(g.makeViewCallback1(g.$scope,"beforeonload",c.paramValues),g.makeViewCallback1(g.$scope,"onload",c.paramValues),g.makeViewCallback1(g.$scope,"afteronload",c.paramValues)))}else""===j?a.location.hash="#!"+h.NotFoundRoute:f=$(h.viewSelector).addClass(h.currentClass)},getAnimation:function(a){return a?this.animations[a.transition]||this.settings.viewTransition:this.settings.viewTransition},endSwapAnimation:function(a,b){var c,d=this,e=document.querySelector(".current.out"),f=document.getElementById(b.viewId),g=d.animation;a&&(d.makeViewCallback1(d.$oldScope,"unload"),d.makeViewCallback1(d.$oldScope,"afterunload")),f.classList.contains("in")&&(f.classList.remove("in"),f.classList.remove(g)),e&&d.bp&&e.parentNode&&(c=e.parentNode,c.removeChild(e))},ensureViewAvailable:function(b,c){if(this.bp){var d,e,f=this.bp.getViewInfo(c);f?d=this.createFragment(f.content):(e=a.location.href.split("#!"),a.location.replace(e[0]+"?"+this.settings.forceReload+"="+e[1])),b?b.parentNode.insertBefore(d,b):document.querySelector(this.settings.mainWrappperSelector).appendChild(d)}},makeViewCallback1:function(a,b,c){a&&a[b]&&a[b].call(a,c||{})},makeViewCallback:function(b,c){{var d,e,f,g=this,h=g.$rootScope;g.settings}if(c&&!b[c])return void(h&&h[b.viewModule]&&h[b.viewModule][c]&&h[b.viewModule][c].call(h,b.paramValues||{}));for(e=b[c].split("."),f=a[e[0]],d=1;d<e.length;d++)1===d&&(g=f),f=f[e[d]];f&&f.call(g,b.paramValues||{})},setDocumentTitle:function(a){var b,c=a.title;if(""!==c){for(b=0;b<a.params.length;b++)c=c.replace(":"+a.params[b],a.paramValues[a.params[b]]);document.title=c}},createFragment:function(a){var b=document.createDocumentFragment(),c=document.createElement("div");for(c.innerHTML=a;c.firstChild;)b.appendChild(c.firstChild);return b},hasAnimations:function(){var a=!1,c=document.createElement("div"),d="animation",e="",f="Webkit Moz O ms Khtml".split(" "),g="",h=0;if(c.style.animationName&&(a=!0),a===!1)for(h=0;h<f.length;h++)if(c.style[f[h]+"AnimationName"]!==b){g=f[h],d=g+"Animation",e="-"+g.toLowerCase()+"-",a=!0;break}return a},storeAsyncContent:function(a){this.bp.updateViewsFromFragment(this.settings.viewSelector,a)},animations:{slide:"slide",fade:"fade",flip:"flip"},settings:{routes:[],viewSelector:".content-pane",currentClass:"current",mainWrappperSelector:"main",NotFoundView:"nofoundView",NotFoundRoute:"404",defaultTitle:"A Single Page Application with Routes",titleSelector:".view-title",forceReload:"_force_reload_",autoSetTitle:!0,parseDOM:!0,initView:!0,intoAnimation:!0,viewTransition:"slide",asyncUrl:b}},d.fn.init.prototype=d.fn,a.spa=d}(window);